<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Upload Files drop-files</title>
    <meta
      name="description"
      content="Upload documents, images and files for free. No registration required. Fast and instant downloading! Safe and Secure. Unlimited Upload/Download speed."
    />
    <link rel="icon" type="image/x-icon" href="./Assets/file.png" />
    <meta property="og:type" content="website" />
    <meta
      property="og:image"
      content="http://drop-files.herokuapp.com/get?uid=Assets&name=icon.png"
    />
    <meta
      property="twitter:image"
      content="http://drop-files.herokuapp.com/get?uid=Assets&name=icon.png"
    />
    <link rel="manifest" href="./manifest.json" />
  </head>
  <body>
    <h1>Drop your file here...</h1>
    <hr />
    <p>
      <a href="/index.html">Upload</a> ||
      <a href="/get.html">Fetch</a>
    </p>
    <hr />
    <p>‚ùóunique id is used to fetch your files . .</p>
    Enter unique id :
    <input type="text" id="user-id" />
    <input type="file" name="file" id="inp-file" />
    <input type="button" value="Upload" id="file-upload" />
    <p id="file_progress"></p>
  </body>
  <script>
    const upload_file = (name, base64, uid) => {
      let data = { name, base64, uid };
      fetch("/upload", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
      })
        .then((resp) => resp.json())
        .then((data) => console.log(data));
    };

    const readFile = (file) => {
      const uid = document.querySelector("#user-id");
      const reader = new FileReader();
      reader.addEventListener("load", (event) => {
        const result = event.target.result;
        upload_file(file.name, result, uid.value);
      });

      reader.addEventListener("progress", (event) => {
        if (event.loaded && event.total) {
          const percent = (event.loaded / event.total) * 100;
          const progress = document.querySelector("#file_progress");
          progress.innerHTML = `Progress: ${Math.round(percent)}`;
        }
      });
      reader.readAsDataURL(file);
    };

    const _file_change = () => {
      const _file = document.querySelector("#inp-file");
      const fileList = _file.files;
      console.log(fileList[0]);
      readFile(fileList[0]);
    };

    const _btn_upload = document.querySelector("#file-upload");
    _btn_upload.addEventListener("click", () => _file_change());
  </script>
</html>
